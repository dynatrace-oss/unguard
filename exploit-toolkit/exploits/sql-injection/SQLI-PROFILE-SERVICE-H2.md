# SQL Injection

Utilizing [SQL injection](https://owasp.org/www-community/attacks/SQL_Injection) can lead to sensitive data being read
and/or databases to be modified (Insert/Update/Delete).
In addition, administrative operations such as shutting down the DBMS can also be completed.

Unguard provides the functionality to upload a biography text for each user, and as the string is not checked before
being inserted into an SQL statement, it is possible to insert SQL commands which will then be run.

## Preconditions and Requirements

For this exploit to work you need:

* [unguard](../../../docs/DEV-GUIDE.md) deployed and running
* (optional) [unguard-exploit-toolkit](../../INSTALL.md) set up

## Exploitation

To inject an SQL command, you simply need to log into Unguard, go to your profile page and insert a bio including some
SQL statements which need to be properly prepared (see the next chapter "w/o Toolkit CLI").

### w/o Toolkit CLI

SQL injections are possible via the frontend. As mentioned before, you can upload a bio including SQL
code on the profile page.

An example for an SQL statement to run:

```sql
UPDATE bio
SET bio_text = 'injected'
WHERE 1 = 1;
```

This will set the bio_text to 'injected' for every user that already had a bio set.

In order to inject this into the database, the content of the bio needs to be adapted slightly:

1. Bio already exists (button says 'Update Bio')

```
' WHERE 0 = 1; UPDATE bio SET bio_text = 'injected' WHERE 1 = 1; --
```

As you can see, the `'` in the beginning as well as the `--` in the end are added to allow the statement to be
run without causing an error.

2. Bio doesn't yet exist (button says 'Add Bio')

```
'); UPDATE bio SET bio_text = 'injected' WHERE 1 = 1; --
```

In this case, the beginning has to be slightly different to accommodate the syntax of the ```INSERT INTO``` statement.

### With Toolkit CLI

Using the `ug-exploit` tool, SQL statements can be injected.
Make sure to use `ug-exploit login` first, as you need to be logged in to post a bio.

Afterwards, use `ug-exploit sql-inject` and type your desired command.
When using the CLI, you only need to specify the SQL statement to be injected. In this example,
your input would just need to be:

```sql
UPDATE bio
SET bio_text = 'injected'
WHERE 1 = 1;
```

The returned status code for this exploit will always be 500, no matter if it was successful or not.

#### Examples

Deleting all entries of the table:
```h2
TRUNCATE TABLE bio;
```

## Further Details

* [SQL Injection - OWASP](https://owasp.org/www-community/attacks/SQL_Injection)
